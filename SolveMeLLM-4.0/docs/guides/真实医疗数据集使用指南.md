# 真实医疗数据集使用指南

## 📚 可用的真实医疗数据集

### 1. PubMedQA（推荐，可直接使用）

**数据集信息**：
- **来源**：Hugging Face
- **任务**：医疗问答（二分类：Yes/No）
- **大小**：约1,000个标注样本（pqa_labeled）
- **特点**：真实医疗问答数据，包含问题和上下文
- **访问**：无需申请，直接可用

**使用方法**：
```python
# 在 train_medical_dataset.py 中修改：
DATASET_NAME = 'pubmed_qa'  # 改为 'pubmed_qa'
use_synthetic = False  # 改为 False
```

**安装依赖**：
```bash
pip install datasets transformers
```

**首次使用**：
- 首次运行会自动从Hugging Face下载数据集（可能需要几分钟）
- 需要网络连接

---

### 2. 其他医疗数据集（需要额外配置）

#### MIMIC-III
- **特点**：大规模真实医疗记录
- **问题**：需要申请访问权限（需要完成CITI培训）
- **不推荐**：对于快速测试来说太复杂

#### 自定义数据集
如果你有自己的医疗数据集，可以：
1. 转换为Hugging Face Dataset格式
2. 修改 `medical_constrained_classification.py` 中的加载逻辑

---

## 🚀 快速开始

### 步骤1：安装依赖

```bash
pip install datasets transformers torch tqdm numpy
```

### 步骤2：修改训练脚本

编辑 `train_medical_dataset.py`：

```python
# 配置
DATASET_NAME = 'pubmed_qa'  # 改为 'pubmed_qa'（或保持 'synthetic' 使用合成数据）
# ... 其他配置保持不变
```

### 步骤3：运行训练

```bash
cd SolveMeLLM-4.0
python train_medical_dataset.py
```

---

## 📊 数据集对比

| 数据集 | 类型 | 样本数 | 访问难度 | 推荐度 |
|--------|------|--------|----------|--------|
| **synthetic** | 合成 | 可自定义 | ⭐ 无需 | ⭐⭐⭐⭐⭐ 快速测试 |
| **pubmed_qa** | 真实 | ~1,000 | ⭐ 直接可用 | ⭐⭐⭐⭐ 真实数据 |
| **MIMIC-III** | 真实 | 数百万 | ⭐⭐⭐⭐⭐ 需申请 | ⭐⭐ 研究用 |

---

## ⚠️ 注意事项

### 1. 数据格式要求

真实数据集需要满足以下格式：
- 必须有 `text` 字段（文本内容）
- 必须有 `label` 字段（0或1，二分类）

### 2. 约束定义

当前约束规则适用于：
- **轻微症状不应该被预测为严重疾病**
- **药物相互作用约束**
- **年龄相关约束**

如果使用真实数据集，可能需要根据数据集特点调整约束规则。

### 3. 数据平衡

代码会自动进行类别平衡（确保正负样本数量相等），但如果真实数据集本身不平衡，可能需要手动调整。

---

## 🔍 如何查找更多数据集

### Hugging Face 数据集库

访问：https://huggingface.co/datasets

搜索关键词：
- `medical`
- `healthcare`
- `clinical`
- `biomedical`

### 示例搜索

```python
from datasets import list_datasets

# 列出所有医疗相关数据集
medical_datasets = [d for d in list_datasets() if 'medical' in d.lower() or 'health' in d.lower()]
print(medical_datasets)
```

---

## 💡 使用建议

### 对于快速测试
- **推荐**：使用 `synthetic`（合成数据）
- **优点**：快速、可控、无需网络

### 对于真实验证
- **推荐**：使用 `pubmed_qa`
- **优点**：真实数据、无需申请、可直接使用

### 对于深入研究
- **推荐**：申请 MIMIC-III 或使用自己的数据集
- **优点**：大规模、真实场景

---

## 🐛 常见问题

### Q1: 下载数据集失败
**A**: 检查网络连接，可能需要代理或VPN

### Q2: 数据集格式不匹配
**A**: 查看数据集文档，可能需要调整数据加载代码

### Q3: 内存不足
**A**: 减少 `MAX_SAMPLES_TRAIN` 和 `MAX_SAMPLES_VAL`

---

## 📝 示例：使用 PubMedQA

```python
# train_medical_dataset.py
DATASET_NAME = 'pubmed_qa'
MAX_SAMPLES_TRAIN = 5000  # PubMedQA只有约1000个样本，会使用全部
MAX_SAMPLES_VAL = 200
# ... 其他配置
```

运行后，代码会：
1. 自动下载 PubMedQA 数据集
2. 转换为统一格式
3. 应用医疗约束规则
4. 开始训练

---

## 🎯 下一步

1. **测试 PubMedQA**：先用小样本测试是否能正常加载
2. **调整约束规则**：根据真实数据特点调整约束
3. **对比结果**：对比合成数据和真实数据的训练结果

